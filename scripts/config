#!/bin/bash

source _common.sh
source /usr/share/yunohost/helpers

ynh_abort_if_errors
ynh_app_config_apply() {
    _ynh_app_config_apply

    if [ "${changed[syncyunohost]}" == "true" ] && [ $syncyunohost == "true" ]
    then
        ynh_print_info "syncyunohost scripts install"
        syncyunohost_scripts_install
    elif [ "${changed[syncyunohost]}" == "true" ] && [ $syncyunohost == "false" ]
    then
        ynh_print_info "syncyunohost uninstall"
        syncyunohost_modules_deactivate
        syncyunohost_scripts_remove
        ynh_app_setting_set --key=syncyunohost_enabled --value=0
    fi
    if [ "${changed[syncyunohost_base_domain]}" == "true" || "${changed[syncyunohost_main_group]}" == "true" ] && [ $syncyunohost_enabled == "true" ]
    then
        syncyunohost_modules_activate
    elif [ "${changed[syncyunohost_enabled]}" == "true" ] && [ $syncyunohost_enabled == "false" ]
    then
        syncyunohost_modules_deactivate
    fi
}

ynh_app_config_run $1
